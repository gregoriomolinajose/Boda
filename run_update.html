<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Update Event Ower</title>
</head>

<body>
    <h1>Actualizando Propietario de Evento...</h1>
    <p id="status">Verificando sesión activa...</p>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAsbrZn2FEKiIweJTBS0q09HyEfgQdTiE8",
            authDomain: "invitations-7c9cb.firebaseapp.com",
            projectId: "invitations-7c9cb",
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const statusEl = document.getElementById("status");

        async function updateEvents(uid) {
            try {
                statusEl.innerText = "Surgió sesión con UID: " + uid + ". Buscando eventos para asignar...";

                const eventsSnapshot = await getDocs(collection(db, "events"));
                const promises = [];

                eventsSnapshot.forEach((eventDoc) => {
                    promises.push(updateDoc(eventDoc.ref, { userId: uid }));
                });

                await Promise.all(promises);
                statusEl.innerText = "¡Éxito! Todos los eventos en la base de datos ahora te pertenecen. Revisa tu panel (portal.html).";
            } catch (error) {
                statusEl.innerText = "Error crítico: " + error.message;
                console.error(error);
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                updateEvents(user.uid);
            } else {
                statusEl.innerText = "Error: No estás logueado en este navegador. Primero ve a login.html o portal.html e inicia sesión.";
            }
        });
    </script>
</body>

</html>